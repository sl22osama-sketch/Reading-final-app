<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>منصة القراءة الذكية - تطوير مهارات القراءة</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Noto+Sans+Arabic:wght@300;400;500;600;700;800&family=Cairo:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        * {
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Cairo', 'Noto Sans Arabic', sans-serif;
            background: linear-gradient(135deg, 
                #1e3a8a 0%,   /* أزرق داكن مريح */
                #1e40af 20%,  /* أزرق متوسط */
                #3b82f6 40%,  /* أزرق فاتح */
                #06b6d4 60%,  /* سماوي */
                #0891b2 80%,  /* أزرق مخضر */
                #1e3a8a 100%  /* عودة للأزرق الداكن */
            );
            background-size: 300% 300%;
            animation: gradientShift 20s ease infinite;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            25% { background-position: 100% 50%; }
            50% { background-position: 100% 100%; }
            75% { background-position: 0% 100%; }
            100% { background-position: 0% 50%; }
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 25% 25%, rgba(255, 255, 255, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 75% 75%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 50% 10%, rgba(102, 126, 234, 0.2) 0%, transparent 40%),
                radial-gradient(circle at 10% 90%, rgba(245, 87, 108, 0.15) 0%, transparent 40%),
                radial-gradient(circle at 90% 10%, rgba(79, 172, 254, 0.15) 0%, transparent 40%),
                linear-gradient(45deg, rgba(255, 255, 255, 0.05) 0%, transparent 100%);
            pointer-events: none;
            z-index: -1;
            animation: backgroundMove 30s ease-in-out infinite;
        }
        
        @keyframes backgroundMove {
            0%, 100% { transform: translateX(0) translateY(0); }
            25% { transform: translateX(-20px) translateY(-10px); }
            50% { transform: translateX(20px) translateY(10px); }
            75% { transform: translateX(-10px) translateY(20px); }
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 255, 255, 0.8);
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.15),
                0 8px 25px rgba(0, 0, 0, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.9);
            position: relative;
            overflow: hidden;
        }
        
        .glass-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
        }
        
        .glass-card-dark {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.15);
        }
        
        .reading-text {
            line-height: 2.8;
            font-size: 1.75rem;
            font-weight: 600;
            color: #1f2937;
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.8);
            letter-spacing: 1px;
            word-spacing: 6px;
            font-family: 'Amiri', 'Noto Sans Arabic', serif;
            text-align: justify;
            padding: 2rem;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.98), rgba(248, 250, 252, 0.95));
            border-radius: 15px;
            border: 2px solid rgba(59, 130, 246, 0.2);
        }
        
        .level-1 { font-size: 1.5rem; line-height: 2.5; }
        .level-2 { font-size: 1.65rem; line-height: 2.6; }
        .level-3 { font-size: 1.75rem; line-height: 2.8; }
        .level-4 { font-size: 1.85rem; line-height: 3; }
        
        .timer-circle {
            stroke-dasharray: 283;
            stroke-dashoffset: 283;
            transition: stroke-dashoffset 1s linear;
            filter: drop-shadow(0 0 12px rgba(59, 130, 246, 0.6));
        }
        
        .timer-container {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.15), rgba(255, 255, 255, 0.08));
            backdrop-filter: blur(30px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.3),
                0 8px 30px rgba(79, 70, 229, 0.2),
                inset 0 2px 0 rgba(255, 255, 255, 0.3);
            position: relative;
        }
        
        .timer-container::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, #4f46e5, #7c3aed, #ec4899, #f59e0b);
            border-radius: inherit;
            z-index: -1;
            opacity: 0.6;
            filter: blur(8px);
        }
        
        .btn-gradient {
            background: linear-gradient(145deg, #4f46e5, #7c3aed, #ec4899);
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 
                0 10px 30px rgba(79, 70, 229, 0.4),
                0 4px 15px rgba(124, 58, 237, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            font-weight: 700;
            transform: translateY(0) scale(1);
            backdrop-filter: blur(10px);
        }
        
        .btn-gradient:hover {
            transform: translateY(-6px) scale(1.05);
            box-shadow: 
                0 20px 50px rgba(79, 70, 229, 0.6),
                0 8px 25px rgba(124, 58, 237, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            background: linear-gradient(145deg, #5b21b6, #be185d, #f59e0b);
        }
        
        .btn-gradient::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.6s;
        }
        
        .btn-gradient:hover::before {
            left: 100%;
        }
        
        .btn-success {
            background: linear-gradient(145deg, #48bb78, #38a169);
            box-shadow: 0 8px 25px rgba(72, 187, 120, 0.4);
        }
        
        .btn-success:hover {
            transform: translateY(-4px);
            box-shadow: 0 15px 40px rgba(72, 187, 120, 0.6);
            background: linear-gradient(145deg, #38a169, #2f855a);
        }
        
        .btn-danger {
            background: linear-gradient(145deg, #f56565, #e53e3e);
            box-shadow: 0 8px 25px rgba(245, 101, 101, 0.4);
        }
        
        .btn-danger:hover {
            transform: translateY(-4px);
            box-shadow: 0 15px 40px rgba(245, 101, 101, 0.6);
        }
        
        .btn-warning {
            background: linear-gradient(145deg, #ed8936, #dd6b20);
            box-shadow: 0 8px 25px rgba(237, 137, 54, 0.4);
        }
        
        .btn-warning:hover {
            transform: translateY(-4px);
            box-shadow: 0 15px 40px rgba(237, 137, 54, 0.6);
        }
        
        .progress-bar {
            background: linear-gradient(90deg, #48bb78, #38a169, #2f855a);
            transition: width 0.5s ease;
            box-shadow: 0 4px 15px rgba(72, 187, 120, 0.4);
            position: relative;
            overflow: hidden;
        }
        
        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            animation: progressShine 2s infinite;
        }
        
        @keyframes progressShine {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .word-highlight {
            background: linear-gradient(120deg, #fbbf24, #f59e0b);
            padding: 4px 12px;
            border-radius: 12px;
            color: #1f2937;
            font-weight: 800;
            text-shadow: 0 1px 2px rgba(255, 255, 255, 0.8);
            animation: wordPulse 1.2s infinite;
            box-shadow: 0 4px 15px rgba(251, 191, 36, 0.6);
            border: 2px solid rgba(245, 158, 11, 0.8);
        }
        
        @keyframes wordPulse {
            0%, 100% { transform: scale(1); box-shadow: 0 4px 15px rgba(240, 147, 251, 0.5); }
            50% { transform: scale(1.08); box-shadow: 0 8px 25px rgba(240, 147, 251, 0.7); }
        }
        
        .stats-card {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.8));
            backdrop-filter: blur(25px);
            border: 2px solid rgba(255, 255, 255, 0.9);
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }
        
        .stats-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.6s;
        }
        
        .stats-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.15);
        }
        
        .stats-card:hover::before {
            left: 100%;
        }
        
        .floating-animation {
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg) scale(1); }
            25% { transform: translateY(-12px) rotate(1deg) scale(1.02); }
            50% { transform: translateY(-20px) rotate(0deg) scale(1.05); }
            75% { transform: translateY(-12px) rotate(-1deg) scale(1.02); }
        }
        
        /* Enhanced Particle effect */
        .container::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(3px 3px at 20px 30px, rgba(255, 255, 255, 0.8), transparent),
                radial-gradient(2px 2px at 40px 70px, rgba(102, 126, 234, 0.6), transparent),
                radial-gradient(1px 1px at 90px 40px, rgba(245, 87, 108, 0.5), transparent),
                radial-gradient(2px 2px at 130px 80px, rgba(79, 172, 254, 0.4), transparent),
                radial-gradient(1px 1px at 160px 30px, rgba(240, 147, 251, 0.6), transparent),
                radial-gradient(2px 2px at 200px 60px, rgba(255, 255, 255, 0.3), transparent),
                radial-gradient(1px 1px at 250px 90px, rgba(102, 126, 234, 0.4), transparent);
            background-repeat: repeat;
            background-size: 300px 150px;
            animation: sparkle 25s linear infinite;
            pointer-events: none;
            z-index: 1;
        }
        
        @keyframes sparkle {
            0% { transform: translateY(0px) rotate(0deg); opacity: 1; }
            50% { opacity: 0.7; }
            100% { transform: translateY(-120px) rotate(360deg); opacity: 1; }
        }
        
        /* Additional background layer */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                conic-gradient(from 0deg at 20% 20%, transparent 0deg, rgba(102, 126, 234, 0.1) 60deg, transparent 120deg),
                conic-gradient(from 180deg at 80% 80%, transparent 0deg, rgba(245, 87, 108, 0.08) 60deg, transparent 120deg),
                conic-gradient(from 90deg at 50% 50%, transparent 0deg, rgba(79, 172, 254, 0.06) 90deg, transparent 180deg);
            pointer-events: none;
            z-index: -1;
            animation: conicRotate 40s linear infinite;
        }
        
        @keyframes conicRotate {
            0% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.1); }
            100% { transform: rotate(360deg) scale(1); }
        }
        
        .level-badge {
            background: linear-gradient(145deg, #3b82f6, #1e40af);
            color: white;
            padding: 8px 16px;
            border-radius: 25px;
            font-weight: 700;
            font-size: 0.9rem;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
            animation: badgeGlow 2s ease-in-out infinite alternate;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        @keyframes badgeGlow {
            from { box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3); }
            to { box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5); }
        }
        
        .encouragement-card {
            background: linear-gradient(145deg, #3b82f6, #1d4ed8);
            color: white;
            border-radius: 20px;
            padding: 1.5rem;
            text-align: center;
            font-weight: 600;
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.4);
            animation: encouragementPulse 3s ease-in-out infinite;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        @keyframes encouragementPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        
        .audio-wave {
            display: inline-block;
            width: 4px;
            height: 20px;
            background: linear-gradient(to top, #48bb78, #38a169);
            margin: 0 2px;
            border-radius: 2px;
            animation: audioWave 1.5s ease-in-out infinite;
        }
        
        .audio-wave:nth-child(2) { animation-delay: 0.1s; }
        .audio-wave:nth-child(3) { animation-delay: 0.2s; }
        .audio-wave:nth-child(4) { animation-delay: 0.3s; }
        .audio-wave:nth-child(5) { animation-delay: 0.4s; }
        
        @keyframes audioWave {
            0%, 100% { height: 20px; }
            50% { height: 40px; }
        }
        
        .level-selector {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(15px);
            border: 2px solid rgba(255, 255, 255, 0.8);
            border-radius: 15px;
            padding: 1rem;
            margin-bottom: 2rem;
        }
        
        .level-button {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.95), rgba(248, 250, 252, 0.9));
            backdrop-filter: blur(15px);
            border: 2px solid rgba(59, 130, 246, 0.3);
            border-radius: 16px;
            padding: 1.5rem;
            margin: 0.5rem;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            color: #1f2937;
        }
        
        .level-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.6s;
        }
        
        .level-button:hover {
            transform: translateY(-6px) scale(1.02);
            box-shadow: 0 15px 40px rgba(79, 70, 229, 0.3);
            border-color: rgba(255, 255, 255, 0.4);
        }
        
        .level-button:hover::before {
            left: 100%;
        }
        
        .level-button.active {
            background: linear-gradient(145deg, #3b82f6, #1d4ed8);
            color: white;
            border-color: rgba(59, 130, 246, 0.8);
            box-shadow: 
                0 15px 40px rgba(59, 130, 246, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }
        
        .progress-chart {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 2rem;
            margin-top: 2rem;
        }
        
        .voice-selector {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(15px);
            border: 2px solid rgba(102, 126, 234, 0.3);
            border-radius: 12px;
            padding: 1rem;
            margin-top: 1rem;
        }
        
        .audio-quality-indicator {
            display: inline-flex;
            align-items: center;
            background: linear-gradient(145deg, #48bb78, #38a169);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .phonetic-helper {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid rgba(102, 126, 234, 0.3);
            border-radius: 12px;
            padding: 1rem;
            margin-top: 1rem;
            font-size: 0.9rem;
            color: #4a5568;
        }
    </style>
</head>
<body>
    <div class="container mx-auto px-4 py-8 max-w-7xl">
        <!-- Header -->
        <div class="text-center mb-16 relative">
            <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/5 to-transparent h-px top-1/2"></div>
            <div class="relative z-10 glass-card rounded-3xl p-8 mx-auto max-w-4xl">
                <h1 class="text-7xl font-bold bg-gradient-to-r from-blue-600 via-indigo-700 to-purple-700 bg-clip-text text-transparent mb-6 floating-animation">
                    📚 منصة القراءة الذكية
                </h1>
                <p class="text-2xl text-gray-800 font-semibold mb-6 leading-relaxed">
                    تطوير مهارات القراءة والفهم للمرحلتين الإعدادية والثانوية
                </p>
                <div class="flex justify-center gap-4 flex-wrap">
                    <span class="level-badge">🎯 تعلم</span>
                    <span class="level-badge">📈 تطور</span>
                    <span class="level-badge">⭐ تميز</span>
                </div>
            </div>
        </div>

        <!-- Level Selection -->
        <div class="level-selector glass-card rounded-3xl mb-8">
            <h3 class="text-2xl font-bold text-gray-800 mb-4 text-center">🎓 اختر مستواك التعليمي</h3>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                <div class="level-button active" data-level="1">
                    <div class="text-center">
                        <div class="text-3xl mb-2">🌱</div>
                        <div class="font-bold text-lg">المستوى الأول</div>
                        <div class="text-sm text-gray-600">للطلاب المبتدئين</div>
                    </div>
                </div>
                <div class="level-button" data-level="2">
                    <div class="text-center">
                        <div class="text-3xl mb-2">🌿</div>
                        <div class="font-bold text-lg">المستوى الثاني</div>
                        <div class="text-sm text-gray-600">للطلاب المتوسطين</div>
                    </div>
                </div>
                <div class="level-button" data-level="3">
                    <div class="text-center">
                        <div class="text-3xl mb-2">🌳</div>
                        <div class="font-bold text-lg">المستوى الثالث</div>
                        <div class="text-sm text-gray-600">للطلاب المتقدمين</div>
                    </div>
                </div>
                <div class="level-button" data-level="4">
                    <div class="text-center">
                        <div class="text-3xl mb-2">🏆</div>
                        <div class="font-bold text-lg">المستوى الرابع</div>
                        <div class="text-sm text-gray-600">للطلاب المتميزين</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Encouragement Card -->
        <div class="encouragement-card mb-8">
            <div class="text-2xl font-bold mb-2" id="encouragementTitle">🌟 أنت قادر على التميز!</div>
            <div class="text-lg" id="encouragementText">القراءة مفتاح المعرفة، وأنت تملك هذا المفتاح. ابدأ رحلتك نحو التفوق!</div>
        </div>

        <!-- Main Content -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Reading Section -->
            <div class="lg:col-span-2">
                <div class="glass-card rounded-3xl p-8 mb-8">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-4xl font-bold text-gray-800">📖 نص القراءة</h2>
                        <div class="flex gap-3">
                            <select id="textSelect" class="px-6 py-3 rounded-xl border-2 border-purple-200 bg-white/90 backdrop-blur-sm font-medium text-lg">
                                <option value="0">النص الأول</option>
                                <option value="1">النص الثاني</option>
                                <option value="2">النص الثالث</option>
                                <option value="3">النص الرابع</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="glass-card-dark rounded-2xl mb-6">
                        <div id="readingText" class="reading-text level-1">
                            <!-- النص سيتم تحميله هنا -->
                        </div>
                    </div>
                    
                    <!-- Reading Controls -->
                    <div class="flex flex-wrap justify-center gap-4 mb-6">
                        <button id="startBtn" class="btn-gradient text-white px-10 py-4 rounded-xl font-bold text-xl">
                            🎯 ابدأ القراءة
                        </button>
                        <button id="pauseBtn" class="btn-danger text-white px-10 py-4 rounded-xl font-bold text-xl" disabled>
                            ⏸️ توقف
                        </button>
                        <button id="resetBtn" class="btn-warning text-white px-10 py-4 rounded-xl font-bold text-xl">
                            🔄 إعادة تعيين
                        </button>
                    </div>
                    
                    <!-- Audio Helper Status -->
                    <div id="audioStatus" class="text-center mb-4 p-3 bg-green-50 rounded-xl border border-green-200 hidden">
                        <div class="text-lg font-bold text-green-700">🎧 المساعد الصوتي يعمل</div>
                        <div class="text-sm text-green-600">استمع واتبع الكلمات المضيئة لتحسين قراءتك</div>
                    </div>
                    
                    <!-- Audio Reading Helper for Weak Students -->
                    <div class="glass-card-dark rounded-2xl p-6 mb-6">
                        <h4 class="text-2xl font-bold text-gray-800 mb-4 text-center">
                            🎧 مساعد القراءة للطلاب الضعاف
                            <span class="audio-quality-indicator">📚 تعلم بالاستماع</span>
                            <div id="audioIndicator" class="hidden mt-2">
                                <span class="audio-wave"></span>
                                <span class="audio-wave"></span>
                                <span class="audio-wave"></span>
                                <span class="audio-wave"></span>
                                <span class="audio-wave"></span>
                            </div>
                        </h4>
                        
                        <div class="bg-blue-50 border border-blue-200 rounded-xl p-4 mb-6">
                            <h5 class="font-bold text-blue-800 mb-2">💡 كيف يساعدك هذا القسم:</h5>
                            <ul class="text-sm text-blue-700 space-y-1">
                                <li>• استمع للنص أولاً لتتعلم النطق الصحيح</li>
                                <li>• اتبع الكلمات المضيئة لتحسين التركيز</li>
                                <li>• استخدم السرعة البطيئة في البداية</li>
                                <li>• كرر الجمل الصعبة عدة مرات</li>
                            </ul>
                        </div>
                        
                        <div class="flex flex-wrap justify-center gap-4 mb-6">
                            <button id="testAudioBtn" class="bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white px-6 py-3 rounded-xl font-bold text-lg transform hover:scale-105 transition-all">
                                🔊 اختبار المساعد الصوتي
                            </button>
                            <button id="playAudioBtn" class="btn-success text-white px-8 py-3 rounded-xl font-bold text-lg">
                                🎧 استمع للنص (مساعدة)
                            </button>
                            <button id="pauseAudioBtn" class="btn-danger text-white px-8 py-3 rounded-xl font-bold text-lg" disabled>
                                ⏸️ إيقاف مؤقت
                            </button>
                            <button id="stopAudioBtn" class="btn-warning text-white px-8 py-3 rounded-xl font-bold text-lg">
                                ⏹️ إيقاف المساعد
                            </button>
                            <button id="repeatAudioBtn" class="btn-gradient text-white px-8 py-3 rounded-xl font-bold text-lg">
                                🔄 كرر الجملة
                            </button>
                        </div>
                        

                        
                        <!-- Audio Helper Settings -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                            <div class="text-center">
                                <label class="block text-lg font-bold text-gray-700 mb-3">سرعة المساعد</label>
                                <input type="range" id="speedRange" min="0.3" max="1.2" step="0.1" value="0.5" 
                                       class="w-full h-3 bg-gradient-to-r from-blue-200 to-purple-200 rounded-lg appearance-none cursor-pointer">
                                <span id="speedValue" class="text-lg font-bold text-gray-600">0.5x</span>
                                <div class="text-xs text-gray-500 mt-1">ابدأ ببطء للتعلم</div>
                            </div>
                            <div class="text-center">
                                <label class="block text-lg font-bold text-gray-700 mb-3">وضوح الصوت</label>
                                <input type="range" id="pitchRange" min="0.9" max="1.2" step="0.1" value="1" 
                                       class="w-full h-3 bg-gradient-to-r from-green-200 to-blue-200 rounded-lg appearance-none cursor-pointer">
                                <span id="pitchValue" class="text-lg font-bold text-gray-600">1.0</span>
                                <div class="text-xs text-gray-500 mt-1">صوت واضح ومفهوم</div>
                            </div>
                            <div class="text-center">
                                <label class="block text-lg font-bold text-gray-700 mb-3">قوة الصوت</label>
                                <input type="range" id="volumeRange" min="0.7" max="1" step="0.1" value="1" 
                                       class="w-full h-3 bg-gradient-to-r from-yellow-200 to-red-200 rounded-lg appearance-none cursor-pointer">
                                <span id="volumeValue" class="text-lg font-bold text-gray-600">100%</span>
                                <div class="text-xs text-gray-500 mt-1">صوت عالي للتركيز</div>
                            </div>
                        </div>
                        
                        <!-- Helper Options -->
                        <div class="flex flex-wrap justify-center gap-6 mb-4">
                            <label class="flex items-center bg-white/60 px-4 py-2 rounded-xl">
                                <input type="checkbox" id="highlightWords" checked class="mr-3 w-5 h-5 rounded">
                                <span class="text-lg font-medium text-gray-700">إضاءة الكلمات للمساعدة</span>
                            </label>
                            <label class="flex items-center bg-white/60 px-4 py-2 rounded-xl">
                                <input type="checkbox" id="autoScroll" checked class="mr-3 w-5 h-5 rounded">
                                <span class="text-lg font-medium text-gray-700">متابعة النص تلقائياً</span>
                            </label>
                            <label class="flex items-center bg-white/60 px-4 py-2 rounded-xl">
                                <input type="checkbox" id="slowMode" checked class="mr-3 w-5 h-5 rounded">
                                <span class="text-lg font-medium text-gray-700">وضع التعلم البطيء</span>
                            </label>
                        </div>
                        
                        <!-- Learning Helper -->
                        <div class="phonetic-helper">
                            <h6 class="font-bold text-gray-700 mb-2">🎓 نصائح للطلاب الضعاف:</h6>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
                                <div>• استمع أولاً قبل أن تقرأ بنفسك</div>
                                <div>• اتبع الكلمات المضيئة بعينيك</div>
                                <div>• استخدم السرعة البطيئة في البداية</div>
                                <div>• كرر الجمل الصعبة عدة مرات</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Progress Section -->
                <div class="glass-card rounded-3xl p-8 mb-8">
                    <h3 class="text-4xl font-bold text-gray-800 mb-6">📊 تقدم القراءة</h3>
                    <div class="mb-6">
                        <div class="flex justify-between text-lg font-bold text-gray-700 mb-3">
                            <span>الكلمات المقروءة</span>
                            <span id="progressText">0 / 0</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-6">
                            <div id="progressBar" class="progress-bar h-6 rounded-full" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-6 mt-8">
                        <div class="text-center bg-white/95 p-6 rounded-2xl border border-blue-400/50 hover:border-blue-500 transition-all shadow-lg">
                            <div class="text-5xl font-bold text-blue-600 mb-2" id="wordsRead">0</div>
                            <div class="text-sm text-gray-700 font-semibold">كلمة مقروءة</div>
                        </div>
                        <div class="text-center bg-white/95 p-6 rounded-2xl border border-green-400/50 hover:border-green-500 transition-all shadow-lg">
                            <div class="text-5xl font-bold text-green-600 mb-2" id="readingSpeed">0</div>
                            <div class="text-sm text-gray-700 font-semibold">كلمة/دقيقة</div>
                        </div>
                        <div class="text-center bg-white/95 p-6 rounded-2xl border border-purple-400/50 hover:border-purple-500 transition-all shadow-lg">
                            <div class="text-5xl font-bold text-purple-600 mb-2" id="accuracy">100%</div>
                            <div class="text-sm text-gray-700 font-semibold">دقة القراءة</div>
                        </div>
                        <div class="text-center bg-white/95 p-6 rounded-2xl border border-orange-400/50 hover:border-orange-500 transition-all shadow-lg">
                            <div class="text-5xl font-bold text-orange-600 mb-2" id="level">1</div>
                            <div class="text-sm text-gray-700 font-semibold">المستوى الحالي</div>
                        </div>
                    </div>
                </div>

                <!-- Progress Chart -->
                <div class="progress-chart glass-card">
                    <h3 class="text-2xl font-bold text-gray-800 mb-4 text-center">📈 مخطط التقدم</h3>
                    <canvas id="progressChart" width="400" height="200"></canvas>
                </div>
            </div>

            <!-- Timer and Stats -->
            <div class="space-y-8">
                <!-- Timer -->
                <div class="glass-card rounded-3xl p-8 text-center">
                    <h3 class="text-3xl font-bold text-gray-800 mb-6">⏱️ المؤقت</h3>
                    <div class="timer-container rounded-full w-56 h-56 mx-auto flex items-center justify-center relative">
                        <svg class="w-52 h-52 transform -rotate-90 absolute">
                            <circle cx="104" cy="104" r="50" stroke="#e5e7eb" stroke-width="10" fill="none"/>
                            <circle id="timerCircle" class="timer-circle" cx="104" cy="104" r="50" stroke="#667eea" stroke-width="10" fill="none"/>
                        </svg>
                        <div class="text-center z-10">
                            <div id="timerDisplay" class="text-5xl font-bold text-gray-800">00:00</div>
                            <div class="text-lg text-gray-600 mt-2 font-medium">دقيقة:ثانية</div>
                        </div>
                    </div>
                </div>

                <!-- Statistics -->
                <div class="stats-card rounded-3xl p-8">
                    <h3 class="text-2xl font-bold text-gray-800 mb-6">📈 إحصائياتك</h3>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center p-4 bg-gradient-to-r from-blue-50 to-blue-100 rounded-xl">
                            <span class="font-bold text-gray-700">إجمالي الجلسات</span>
                            <span id="totalSessions" class="text-3xl font-bold text-blue-600">0</span>
                        </div>
                        <div class="flex justify-between items-center p-4 bg-gradient-to-r from-green-50 to-green-100 rounded-xl">
                            <span class="font-bold text-gray-700">إجمالي الكلمات</span>
                            <span id="totalWords" class="text-3xl font-bold text-green-600">0</span>
                        </div>
                        <div class="flex justify-between items-center p-4 bg-gradient-to-r from-purple-50 to-purple-100 rounded-xl">
                            <span class="font-bold text-gray-700">متوسط السرعة</span>
                            <span id="avgSpeed" class="text-3xl font-bold text-purple-600">0</span>
                        </div>
                        <div class="flex justify-between items-center p-4 bg-gradient-to-r from-yellow-50 to-yellow-100 rounded-xl">
                            <span class="font-bold text-gray-700">أفضل سرعة</span>
                            <span id="bestSpeed" class="text-3xl font-bold text-yellow-600">0</span>
                        </div>
                        <div class="flex justify-between items-center p-4 bg-gradient-to-r from-pink-50 to-pink-100 rounded-xl">
                            <span class="font-bold text-gray-700">الوقت الإجمالي</span>
                            <span id="totalTime" class="text-3xl font-bold text-pink-600">0د</span>
                        </div>
                    </div>
                    
                    <button id="clearStats" class="w-full mt-6 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white py-4 rounded-xl font-bold text-lg transition-all transform hover:scale-105">
                        🗑️ مسح الإحصائيات
                    </button>
                </div>
                
                <!-- Enhanced Tips Section -->
                <div class="glass-card rounded-3xl p-8">
                    <h3 class="text-3xl font-bold text-gray-800 mb-6">💡 نصائح للتفوق</h3>
                    <div class="space-y-4 text-sm">
                        <div class="bg-white/90 p-4 rounded-xl border border-blue-400/50 hover:border-blue-500 transition-all shadow-md">
                            <h4 class="font-bold text-blue-700 mb-2">🎧 للطلاب الضعاف:</h4>
                            <p class="text-gray-700">استخدم الصوت البطيء واستمع عدة مرات قبل المحاولة بمفردك</p>
                        </div>
                        <div class="bg-white/90 p-4 rounded-xl border border-green-400/50 hover:border-green-500 transition-all shadow-md">
                            <h4 class="font-bold text-green-700 mb-2">⚡ لزيادة السرعة:</h4>
                            <p class="text-gray-700">ابدأ بسرعة 0.5x ثم زد تدريجياً حتى تصل للسرعة الطبيعية</p>
                        </div>
                        <div class="bg-white/90 p-4 rounded-xl border border-purple-400/50 hover:border-purple-500 transition-all shadow-md">
                            <h4 class="font-bold text-purple-700 mb-2">🎯 للتركيز:</h4>
                            <p class="text-gray-700">استخدم تمييز الكلمات والتمرير التلقائي لمتابعة أفضل</p>
                        </div>
                        <div class="bg-white/90 p-4 rounded-xl border border-orange-400/50 hover:border-orange-500 transition-all shadow-md">
                            <h4 class="font-bold text-orange-700 mb-2">📚 للفهم العميق:</h4>
                            <p class="text-gray-700">اقرأ النص أكثر من مرة وحاول فهم المعنى العام</p>
                        </div>
                        <div class="bg-white/90 p-4 rounded-xl border border-pink-400/50 hover:border-pink-500 transition-all shadow-md">
                            <h4 class="font-bold text-pink-700 mb-2">🏆 للتميز:</h4>
                            <p class="text-gray-700">مارس القراءة يومياً لمدة 15-30 دقيقة لتحقيق أفضل النتائج</p>
                        </div>
                    </div>
                </div>

                <!-- Achievement Badges -->
                <div class="glass-card rounded-3xl p-8">
                    <h3 class="text-2xl font-bold text-gray-800 mb-6">🏅 إنجازاتك</h3>
                    <div id="achievementBadges" class="grid grid-cols-2 gap-4">
                        <!-- سيتم إضافة الشارات هنا -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        class SmartReadingPlatform {
            constructor() {
                // النصوص المتدرجة حسب المستوى
                this.texts = {
                    1: [ // المستوى الأول - للمبتدئين
                        {
                            title: "الطَّائِرُ الصَّغِيرُ",
                            content: "كَانَ هُنَاكَ طَائِرٌ صَغِيرٌ يَعِيشُ فِي غَابَةٍ جَمِيلَةٍ. كَانَ الطَّائِرُ يُحِبُّ الغِنَاءَ كُلَّ صَبَاحٍ. فِي يَوْمٍ مِنَ الأَيَّامِ، قَرَّرَ الطَّائِرُ أَنْ يَسْتَكْشِفَ أَجْزَاءً جَدِيدَةً مِنَ الغَابَةِ. طَارَ عَالِيًا فَوْقَ الأَشْجَارِ وَرَأَى مَنْظَرًا رَائِعًا. عَادَ الطَّائِرُ إِلَى عُشِّهِ سَعِيدًا بِمَا رَآهُ."
                        },
                        {
                            title: "الفَلَّاحُ الطَّيِّبُ",
                            content: "فِي قَرْيَةٍ صَغِيرَةٍ، كَانَ يَعِيشُ فَلَّاحٌ طَيِّبُ القَلْبِ. كَانَ يَزْرَعُ الخُضْرَوَاتِ وَالفَوَاكِهَ فِي حَقْلِهِ الصَّغِيرِ. كُلَّ يَوْمٍ، كَانَ يَسْتَيْقِظُ مُبَكِّرًا لِيَعْتَنِيَ بِنَبَاتَاتِهِ. الجِيرَانُ يُحِبُّونَهُ كَثِيرًا لأَنَّهُ يُسَاعِدُهُمْ دَائِمًا. فِي نِهَايَةِ المَوْسِمِ، كَانَ مَحْصُولُهُ وَفِيرًا وَجَمِيلًا."
                        }
                    ],
                    2: [ // المستوى الثاني - للمتوسطين
                        {
                            title: "رِحْلَةُ الاِكْتِشَافِ",
                            content: "انْطَلَقَتْ مَجْمُوعَةٌ مِنَ الطُّلَّابِ فِي رِحْلَةٍ عِلْمِيَّةٍ إِلَى المُتْحَفِ الطَّبِيعِيِّ. كَانُوا مُتَحَمِّسِينَ لِرُؤْيَةِ الهَيَاكِلِ العَظْمِيَّةِ لِلدِّينَاصُورَاتِ وَالحَيَوَانَاتِ المُنْقَرِضَةِ. شَرَحَ لَهُمُ المُرْشِدُ تَارِيخَ هَذِهِ المَخْلُوقَاتِ وَكَيْفَ عَاشَتْ عَلَى الأَرْضِ مَلَايِينَ السِّنِينَ. تَعَلَّمَ الطُّلَّابُ أَهَمِّيَّةَ الحِفَاظِ عَلَى البِيئَةِ وَحِمَايَةِ الحَيَوَانَاتِ مِنَ الانْقِرَاضِ."
                        },
                        {
                            title: "عَالِمُ الفَضَاءِ الشَّابُّ",
                            content: "أَحْمَدُ طَالِبٌ فِي المَرْحَلَةِ الثَّانَوِيَّةِ يَحْلُمُ بِأَنْ يُصْبِحَ عَالِمَ فَضَاءٍ. يَقْضِي سَاعَاتٍ طَوِيلَةً فِي قِرَاءَةِ الكُتُبِ العِلْمِيَّةِ وَمُشَاهَدَةِ الأَفْلَامِ الوَثَائِقِيَّةِ عَنِ الكَوَاكِبِ وَالنُّجُومِ. يَسْتَخْدِمُ تِلِسْكُوبًا صَغِيرًا لِمُرَاقَبَةِ القَمَرِ وَالكَوَاكِبِ فِي اللَّيْلِ. يُؤْمِنُ أَحْمَدُ بِأَنَّ العِلْمَ وَالمَعْرِفَةَ هُمَا مِفْتَاحُ التَّقَدُّمِ وَالنَّجَاحِ."
                        }
                    ],
                    3: [ // المستوى الثالث - للمتقدمين
                        {
                            title: "التِّكْنُولُوجِيَا وَالتَّعْلِيمُ",
                            content: "شَهِدَ القَرْنُ الحَادِي وَالعِشْرُونَ تَطَوُّرًا هَائِلًا فِي مَجَالِ التِّكْنُولُوجِيَا التَّعْلِيمِيَّةِ. أَصْبَحَتِ الفُصُولُ الذَّكِيَّةُ وَالتَّعَلُّمُ الإِلِكْتُرُونِيُّ جُزْءًا لَا يَتَجَزَّأُ مِنَ العَمَلِيَّةِ التَّعْلِيمِيَّةِ. تُسَاعِدُ هَذِهِ التِّقْنِيَّاتُ الطُّلَّابَ عَلَى فَهْمِ المَفَاهِيمِ المُعَقَّدَةِ بِطَرِيقَةٍ تَفَاعُلِيَّةٍ وَمُمْتِعَةٍ. كَمَا تُتِيحُ لِلْمُعَلِّمِينَ إِمْكَانِيَّةَ تَخْصِيصِ التَّعْلِيمِ وَفْقًا لِاحْتِيَاجَاتِ كُلِّ طَالِبٍ عَلَى حِدَةٍ."
                        },
                        {
                            title: "الطَّاقَةُ المُتَجَدِّدَةُ",
                            content: "تُعَدُّ الطَّاقَةُ المُتَجَدِّدَةُ مِنْ أَهَمِّ الحُلُولِ لِمُوَاجَهَةِ تَحَدِّيَاتِ التَّغَيُّرِ المُنَاخِيِّ وَالحِفَاظِ عَلَى البِيئَةِ. تَشْمَلُ مَصَادِرُ الطَّاقَةِ المُتَجَدِّدَةِ الطَّاقَةَ الشَّمْسِيَّةَ وَطَاقَةَ الرِّيَاحِ وَالطَّاقَةَ المَائِيَّةَ. تَسْتَثْمِرُ العَدِيدُ مِنَ الدُّوَلِ مِلْيَارَاتِ الدُّولَارَاتِ فِي تَطْوِيرِ هَذِهِ التِّقْنِيَّاتِ لِتَقْلِيلِ الاِعْتِمَادِ عَلَى الوَقُودِ الأُحْفُورِيِّ وَخَفْضِ انْبِعَاثَاتِ الكَرْبُونِ."
                        }
                    ],
                    4: [ // المستوى الرابع - للمتميزين
                        {
                            title: "الذَّكَاءُ الاِصْطِنَاعِيُّ وَمُسْتَقْبَلُ البَشَرِيَّةِ",
                            content: "يُمَثِّلُ الذَّكَاءُ الاِصْطِنَاعِيُّ نَقْلَةً نَوْعِيَّةً فِي تَارِيخِ التِّكْنُولُوجِيَا، حَيْثُ يُحَاكِي قُدْرَاتِ العَقْلِ البَشَرِيِّ فِي التَّعَلُّمِ وَالاِسْتِنْتَاجِ وَحَلِّ المُشْكِلَاتِ. تَتَنَوَّعُ تَطْبِيقَاتُهُ مِنَ الطِّبِّ وَالهَنْدَسَةِ إِلَى التَّعْلِيمِ وَالفُنُونِ. وَرَغْمَ الفَوَائِدِ الهَائِلَةِ الَّتِي يُقَدِّمُهَا، إِلَّا أَنَّهُ يُثِيرُ تَسَاؤُلَاتٍ أَخْلَاقِيَّةً وَاجْتِمَاعِيَّةً مُهِمَّةً حَوْلَ مُسْتَقْبَلِ العَمَلِ وَالخُصُوصِيَّةِ وَالأَمَانِ السَّيْبَرَانِيِّ."
                        },
                        {
                            title: "الحَضَارَةُ الإِسْلَامِيَّةُ وَإِسْهَامَاتُهَا العِلْمِيَّةُ",
                            content: "أَسْهَمَتِ الحَضَارَةُ الإِسْلَامِيَّةُ إِسْهَامَاتٍ جَوْهَرِيَّةً فِي تَقَدُّمِ العُلُومِ وَالمَعَارِفِ الإِنْسَانِيَّةِ عَبْرَ التَّارِيخِ. فَقَدْ بَرَعَ العُلَمَاءُ المُسْلِمُونَ فِي الرِّيَاضِيَّاتِ وَالفَلَكِ وَالطِّبِّ وَالكِيمْيَاءِ وَالفَلْسَفَةِ. أَسَّسُوا بُيُوتَ الحِكْمَةِ وَالمَكْتَبَاتِ الضَّخْمَةَ، وَتَرْجَمُوا التُّرَاثَ اليُونَانِيَّ وَالفَارِسِيَّ وَالهِنْدِيَّ، مُضِيفِينَ إِلَيْهِ اكْتِشَافَاتِهِمْ وَابْتِكَارَاتِهِمُ الأَصِيلَةَ الَّتِي أَثَّرَتْ عَلَى النَّهْضَةِ الأُورُوبِّيَّةِ."
                        }
                    ]
                };
                
                this.encouragements = {
                    start: [
                        { title: "🌟 أنت قادر على التميز!", text: "القراءة مفتاح المعرفة، وأنت تملك هذا المفتاح. ابدأ رحلتك نحو التفوق!" },
                        { title: "🚀 انطلق نحو النجاح!", text: "كل كلمة تقرأها تقربك خطوة من أهدافك. استمر وستصل!" },
                        { title: "💪 قوتك في إصرارك!", text: "المثابرة والتدريب المستمر هما سر النجاح في القراءة." }
                    ],
                    progress: [
                        { title: "🎯 أداء رائع!", text: "تقدمك ملحوظ ومستمر. استمر على هذا المنوال!" },
                        { title: "⭐ تحسن مذهل!", text: "سرعتك في القراءة تتحسن يوماً بعد يوم. أنت على الطريق الصحيح!" },
                        { title: "🏆 إنجاز متميز!", text: "وصلت لمستوى جديد من الإتقان. فخور بك!" }
                    ],
                    complete: [
                        { title: "🎉 مبروك! أكملت النص!", text: "أداء استثنائي! أنت تتقدم بخطوات ثابتة نحو الإتقان." },
                        { title: "✨ إنجاز رائع!", text: "قراءة ممتازة! مهاراتك تتطور بشكل مذهل." },
                        { title: "🌟 أحسنت صنعاً!", text: "قراءة متقنة ومتميزة. استمر في هذا التفوق!" }
                    ]
                };
                
                this.currentLevel = 1;
                this.currentTextIndex = 0;
                this.currentWordIndex = 0;
                this.isReading = false;
                this.startTime = null;
                this.timer = null;
                this.elapsedTime = 0;
                this.words = [];
                
                // Speech synthesis properties
                this.speechSynth = window.speechSynthesis;
                this.currentUtterance = null;
                this.isAudioReading = false;
                this.audioWordIndex = 0;
                this.audioTimer = null;
                
                // Progress tracking
                this.progressData = JSON.parse(localStorage.getItem('progressData') || '[]');
                this.chart = null;
                
                this.initializeElements();
                this.loadStats();
                this.setupEventListeners();
                this.updateText();
                this.updateEncouragement('start');
                this.initializeChart();
                this.updateAchievements();
            }
            
            initializeElements() {
                this.elements = {
                    // Level selection
                    levelButtons: document.querySelectorAll('.level-button'),
                    
                    // Text and reading
                    textSelect: document.getElementById('textSelect'),
                    readingText: document.getElementById('readingText'),
                    startBtn: document.getElementById('startBtn'),
                    pauseBtn: document.getElementById('pauseBtn'),
                    resetBtn: document.getElementById('resetBtn'),
                    
                    // Progress
                    progressBar: document.getElementById('progressBar'),
                    progressText: document.getElementById('progressText'),
                    wordsRead: document.getElementById('wordsRead'),
                    readingSpeed: document.getElementById('readingSpeed'),
                    accuracy: document.getElementById('accuracy'),
                    level: document.getElementById('level'),
                    
                    // Timer
                    timerDisplay: document.getElementById('timerDisplay'),
                    timerCircle: document.getElementById('timerCircle'),
                    
                    // Audio
                    testAudioBtn: document.getElementById('testAudioBtn'),
                    playAudioBtn: document.getElementById('playAudioBtn'),
                    pauseAudioBtn: document.getElementById('pauseAudioBtn'),
                    stopAudioBtn: document.getElementById('stopAudioBtn'),
                    repeatAudioBtn: document.getElementById('repeatAudioBtn'),
                    speedRange: document.getElementById('speedRange'),
                    speedValue: document.getElementById('speedValue'),
                    pitchRange: document.getElementById('pitchRange'),
                    pitchValue: document.getElementById('pitchValue'),
                    volumeRange: document.getElementById('volumeRange'),
                    volumeValue: document.getElementById('volumeValue'),
                    highlightWords: document.getElementById('highlightWords'),
                    autoScroll: document.getElementById('autoScroll'),
                    slowMode: document.getElementById('slowMode'),
                    audioIndicator: document.getElementById('audioIndicator'),

                    
                    // Stats
                    totalSessions: document.getElementById('totalSessions'),
                    totalWords: document.getElementById('totalWords'),
                    avgSpeed: document.getElementById('avgSpeed'),
                    bestSpeed: document.getElementById('bestSpeed'),
                    totalTime: document.getElementById('totalTime'),
                    clearStats: document.getElementById('clearStats'),
                    
                    // Encouragement
                    encouragementTitle: document.getElementById('encouragementTitle'),
                    encouragementText: document.getElementById('encouragementText'),
                    
                    // Chart
                    progressChart: document.getElementById('progressChart'),
                    
                    // Achievements
                    achievementBadges: document.getElementById('achievementBadges'),
                    
                    // Audio file input
                    audioFileInput: document.getElementById('audioFileInput'),
                    uploadedFiles: document.getElementById('uploadedFiles'),
                    filesList: document.getElementById('filesList'),
                    
                    // Audio status
                    audioStatus: document.getElementById('audioStatus')
                };
            }
            
            setupEventListeners() {
                // Level selection
                this.elements.levelButtons.forEach((btn, index) => {
                    btn.addEventListener('click', () => {
                        this.selectLevel(index + 1);
                    });
                });
                
                // Text selection
                this.elements.textSelect.addEventListener('change', () => {
                    this.currentTextIndex = parseInt(this.elements.textSelect.value);
                    this.updateText();
                    this.reset();
                    this.stopAudio();
                });
                
                // Reading controls
                this.elements.startBtn.addEventListener('click', () => this.startReading());
                this.elements.pauseBtn.addEventListener('click', () => this.pauseReading());
                this.elements.resetBtn.addEventListener('click', () => this.reset());
                
                // Audio controls
                this.elements.testAudioBtn.addEventListener('click', () => this.testAudio());
                this.elements.playAudioBtn.addEventListener('click', () => this.startAudioReading());
                this.elements.pauseAudioBtn.addEventListener('click', () => this.pauseAudio());
                this.elements.stopAudioBtn.addEventListener('click', () => this.stopAudio());
                this.elements.repeatAudioBtn.addEventListener('click', () => this.repeatCurrentSentence());
                

                
                // Audio helper settings
                this.elements.speedRange.addEventListener('input', (e) => {
                    this.elements.speedValue.textContent = e.target.value + 'x';
                });
                
                this.elements.pitchRange.addEventListener('input', (e) => {
                    this.elements.pitchValue.textContent = e.target.value;
                });
                
                this.elements.volumeRange.addEventListener('input', (e) => {
                    this.elements.volumeValue.textContent = Math.round(e.target.value * 100) + '%';
                });
                
                // Stats
                this.elements.clearStats.addEventListener('click', () => this.clearStats());
                
                // Audio file upload
                this.elements.audioFileInput.addEventListener('change', (e) => this.handleAudioFileUpload(e));
                
                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    if (e.code === 'Space' && !e.target.matches('input, textarea, select')) {
                        e.preventDefault();
                        if (this.isReading) {
                            this.pauseReading();
                        } else {
                            this.startReading();
                        }
                    } else if (e.code === 'Escape') {
                        this.reset();
                        this.stopAudio();
                    } else if (e.code === 'KeyA' && e.ctrlKey) {
                        e.preventDefault();
                        if (this.isAudioReading) {
                            this.pauseAudio();
                        } else {
                            this.startAudioReading();
                        }
                    }
                });
            }
            
            selectLevel(level) {
                this.currentLevel = level;
                this.currentTextIndex = 0;
                
                // Update UI
                this.elements.levelButtons.forEach((btn, index) => {
                    btn.classList.toggle('active', index + 1 === level);
                });
                
                this.elements.level.textContent = level;
                this.updateTextOptions();
                this.updateText();
                this.reset();
                this.stopAudio();
                this.updateEncouragement('start');
            }
            
            updateTextOptions() {
                const texts = this.texts[this.currentLevel];
                this.elements.textSelect.innerHTML = '';
                
                texts.forEach((text, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = text.title;
                    this.elements.textSelect.appendChild(option);
                });
            }
            
            updateText() {
                const currentText = this.texts[this.currentLevel][this.currentTextIndex];
                if (!currentText) return;
                
                this.words = currentText.content.split(' ');
                this.elements.readingText.innerHTML = currentText.content;
                this.elements.readingText.className = `reading-text level-${this.currentLevel}`;
                this.updateProgress();
            }
            
            startReading() {
                if (!this.isReading) {
                    this.isReading = true;
                    this.startTime = Date.now() - this.elapsedTime;
                    this.elements.startBtn.disabled = true;
                    this.elements.pauseBtn.disabled = false;
                    this.startTimer();
                    this.highlightCurrentWord();
                }
            }
            
            pauseReading() {
                if (this.isReading) {
                    this.isReading = false;
                    this.isAudioReading = false;
                    this.elements.startBtn.disabled = false;
                    this.elements.pauseBtn.disabled = true;
                    
                    // Stop all timers and audio
                    clearInterval(this.timer);
                    clearInterval(this.autoTimer);
                    clearInterval(this.visualTimer);
                    this.speechSynth.pause();
                    this.elements.audioIndicator.classList.add('hidden');
                    
                    this.saveSession();
                    this.updateEncouragement('progress');
                }
            }
            
            reset() {
                this.isReading = false;
                this.isAudioReading = false;
                this.currentWordIndex = 0;
                this.elapsedTime = 0;
                this.startTime = null;
                
                this.elements.startBtn.disabled = false;
                this.elements.pauseBtn.disabled = true;
                
                // Clear all timers and stop audio
                clearInterval(this.timer);
                clearInterval(this.autoTimer);
                clearInterval(this.visualTimer);
                this.speechSynth.cancel();
                this.elements.audioIndicator.classList.add('hidden');
                
                this.updateText();
                this.updateProgress();
                this.updateTimer();
                this.updateTimerCircle();
            }
            
            startTimer() {
                // Start automatic audio reading when timer starts
                this.startAutoAudioReading();
                
                this.timer = setInterval(() => {
                    this.elapsedTime = Date.now() - this.startTime;
                    this.updateTimer();
                    this.updateTimerCircle();
                    this.updateReadingSpeed();
                }, 100);
            }
            
            startAutoAudioReading() {
                const currentText = this.texts[this.currentLevel][this.currentTextIndex];
                if (!currentText) return;
                
                // Cancel any existing speech
                this.speechSynth.cancel();
                
                this.words = currentText.content.split(' ');
                this.currentWordIndex = 0;
                this.isAudioReading = true;
                
                // Show audio indicator
                this.elements.audioIndicator.classList.remove('hidden');
                
                // Create speech utterance
                this.currentUtterance = new SpeechSynthesisUtterance(currentText.content);
                
                // Set speech parameters
                let rate = parseFloat(this.elements.speedRange.value);
                if (this.elements.slowMode.checked) {
                    rate = Math.max(0.3, rate * 0.6);
                }
                
                this.currentUtterance.rate = rate;
                this.currentUtterance.pitch = parseFloat(this.elements.pitchRange.value);
                this.currentUtterance.volume = parseFloat(this.elements.volumeRange.value);
                
                // Get Arabic voice
                const voices = this.speechSynth.getVoices();
                const arabicVoice = voices.find(voice => 
                    voice.lang.includes('ar') || 
                    voice.name.toLowerCase().includes('arabic')
                ) || voices[0];
                
                if (arabicVoice) {
                    this.currentUtterance.voice = arabicVoice;
                    this.currentUtterance.lang = arabicVoice.lang;
                } else {
                    this.currentUtterance.lang = 'ar-SA';
                }
                
                // Event handlers
                this.currentUtterance.onstart = () => {
                    console.log('🎧 Audio helper started');
                    this.elements.audioStatus.classList.remove('hidden');
                    this.startAutoWordHighlighting();
                };
                
                this.currentUtterance.onend = () => {
                    console.log('✅ Audio helper completed');
                    this.elements.audioStatus.classList.add('hidden');
                    this.completeReading();
                };
                
                this.currentUtterance.onerror = (event) => {
                    console.error('❌ Audio helper error:', event);
                    this.elements.audioStatus.classList.add('hidden');
                    // Continue with visual reading if audio helper fails
                    this.startVisualReading();
                };
                
                // Start speaking
                try {
                    this.speechSynth.speak(this.currentUtterance);
                } catch (error) {
                    console.error('Error starting auto audio:', error);
                    this.startVisualReading();
                }
            }
            
            startVisualReading() {
                // Fallback visual reading if audio fails
                this.visualTimer = setInterval(() => {
                    if (this.currentWordIndex < this.words.length - 1 && this.isReading) {
                        this.currentWordIndex++;
                        this.highlightCurrentWord();
                        this.updateProgress();
                    } else {
                        this.completeReading();
                    }
                }, 600);
            }
            
            startAutoWordHighlighting() {
                // Estimate word timing based on speech rate
                const baseWordsPerSecond = 2.8;
                const rate = this.elements.slowMode.checked ? 
                    parseFloat(this.elements.speedRange.value) * 0.6 : 
                    parseFloat(this.elements.speedRange.value);
                const wordsPerSecond = baseWordsPerSecond * rate;
                const wordInterval = 1000 / wordsPerSecond;
                
                this.currentWordIndex = 0;
                this.autoTimer = setInterval(() => {
                    if (this.currentWordIndex < this.words.length && this.isReading) {
                        this.highlightCurrentWord();
                        this.updateProgress();
                        this.currentWordIndex++;
                        
                        if (this.currentWordIndex >= this.words.length) {
                            clearInterval(this.autoTimer);
                        }
                    } else {
                        clearInterval(this.autoTimer);
                    }
                }, wordInterval);
            }
            
            highlightCurrentWord() {
                const highlightedWords = this.words.map((word, index) => {
                    if (index === this.currentWordIndex) {
                        return `<span class="word-highlight">${word}</span>`;
                    }
                    return word;
                });
                
                this.elements.readingText.innerHTML = highlightedWords.join(' ');
                
                // Auto scroll to current word
                if (this.elements.autoScroll.checked) {
                    const highlightedElement = this.elements.readingText.querySelector('.word-highlight');
                    if (highlightedElement) {
                        highlightedElement.scrollIntoView({
                            behavior: 'smooth',
                            block: 'center'
                        });
                    }
                }
            }
            
            updateProgress() {
                const progress = this.words.length > 0 ? (this.currentWordIndex / this.words.length) * 100 : 0;
                this.elements.progressBar.style.width = `${progress}%`;
                this.elements.progressText.textContent = `${this.currentWordIndex} / ${this.words.length}`;
                this.elements.wordsRead.textContent = this.currentWordIndex;
            }
            
            updateTimer() {
                const minutes = Math.floor(this.elapsedTime / 60000);
                const seconds = Math.floor((this.elapsedTime % 60000) / 1000);
                this.elements.timerDisplay.textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
            
            updateTimerCircle() {
                const maxTime = 600000; // 10 minutes max
                const progress = Math.min(this.elapsedTime / maxTime, 1);
                const circumference = 2 * Math.PI * 50; // radius = 50
                const offset = circumference - (progress * circumference);
                this.elements.timerCircle.style.strokeDasharray = circumference;
                this.elements.timerCircle.style.strokeDashoffset = offset;
            }
            
            updateReadingSpeed() {
                if (this.elapsedTime > 0) {
                    const minutes = this.elapsedTime / 60000;
                    const speed = Math.round(this.currentWordIndex / minutes);
                    this.elements.readingSpeed.textContent = speed || 0;
                }
            }
            
            completeReading() {
                this.isReading = false;
                this.isAudioReading = false;
                
                // Stop all timers and audio
                clearInterval(this.timer);
                clearInterval(this.autoTimer);
                clearInterval(this.visualTimer);
                this.speechSynth.cancel();
                this.elements.audioIndicator.classList.add('hidden');
                
                // Update UI
                this.elements.startBtn.disabled = false;
                this.elements.pauseBtn.disabled = true;
                
                // Mark as completed
                this.currentWordIndex = this.words.length;
                this.updateProgress();
                
                this.saveSession();
                this.updateEncouragement('complete');
                this.updateAchievements();
                
                setTimeout(() => {
                    const encouragement = this.encouragements.complete[Math.floor(Math.random() * this.encouragements.complete.length)];
                    alert(`${encouragement.title}\n\n${encouragement.text}`);
                }, 500);
            }
            

            
            startAudioReading() {
                const currentText = this.texts[this.currentLevel][this.currentTextIndex];
                if (!currentText) {
                    alert('⚠️ لا يوجد نص للقراءة!');
                    return;
                }
                
                // Cancel any existing speech
                this.speechSynth.cancel();
                
                // Wait for voices to load
                const startSpeech = () => {
                    this.words = currentText.content.split(' ');
                    this.audioWordIndex = 0;
                    this.isAudioReading = true;
                    
                    this.elements.playAudioBtn.disabled = true;
                    this.elements.pauseAudioBtn.disabled = false;
                    this.elements.audioIndicator.classList.remove('hidden');
                    
                    // Create speech utterance
                    this.currentUtterance = new SpeechSynthesisUtterance(currentText.content);
                    
                    // Set speech parameters first
                    let rate = parseFloat(this.elements.speedRange.value);
                    if (this.elements.slowMode.checked) {
                        rate = Math.max(0.3, rate * 0.5);
                    }
                    
                    this.currentUtterance.rate = rate;
                    this.currentUtterance.pitch = parseFloat(this.elements.pitchRange.value);
                    this.currentUtterance.volume = parseFloat(this.elements.volumeRange.value);
                    
                    // Get available voices
                    const voices = this.speechSynth.getVoices();
                    console.log('Available voices:', voices.map(v => `${v.name} (${v.lang})`));
                    
                    // Try to find Arabic voice with multiple fallbacks
                    let selectedVoice = null;
                    
                    // Priority order for Arabic voices
                    const arabicPatterns = [
                        /ar.*sa/i,  // Arabic Saudi
                        /ar.*eg/i,  // Arabic Egypt
                        /ar.*ae/i,  // Arabic UAE
                        /ar/i,      // Any Arabic
                        /arabic/i   // Contains "arabic"
                    ];
                    
                    for (const pattern of arabicPatterns) {
                        selectedVoice = voices.find(voice => 
                            pattern.test(voice.lang) || pattern.test(voice.name)
                        );
                        if (selectedVoice) break;
                    }
                    
                    // If no Arabic voice found, use default but set language
                    if (selectedVoice) {
                        this.currentUtterance.voice = selectedVoice;
                        this.currentUtterance.lang = selectedVoice.lang;
                        console.log('✅ Using voice:', selectedVoice.name, selectedVoice.lang);
                    } else {
                        // Fallback to different Arabic language codes
                        const arabicLangs = ['ar-SA', 'ar-EG', 'ar-AE', 'ar'];
                        this.currentUtterance.lang = arabicLangs[0];
                        console.log('⚠️ No Arabic voice found, using default with ar-SA');
                    }
                    
                    // Event handlers
                    this.currentUtterance.onstart = () => {
                        console.log('🎵 Speech started');
                        if (this.elements.highlightWords.checked) {
                            this.startWordHighlighting();
                        }
                    };
                    
                    this.currentUtterance.onend = () => {
                        console.log('✅ Speech ended');
                        this.stopAudio();
                    };
                    
                    this.currentUtterance.onerror = (event) => {
                        console.error('❌ Speech error:', event);
                        alert(`خطأ في القراءة الصوتية: ${event.error}\nجرب تحديث الصفحة أو استخدم متصفح آخر.`);
                        this.stopAudio();
                    };
                    
                    // Test if speech synthesis is working
                    if (!this.speechSynth) {
                        alert('❌ القراءة الصوتية غير مدعومة في هذا المتصفح!');
                        this.stopAudio();
                        return;
                    }
                    
                    // Start speaking
                    try {
                        console.log('🎤 Starting speech synthesis...');
                        this.speechSynth.speak(this.currentUtterance);
                        
                        // Fallback check - if no speech after 2 seconds, show error
                        setTimeout(() => {
                            if (this.isAudioReading && !this.speechSynth.speaking) {
                                console.warn('⚠️ Speech may not have started');
                                alert('🔊 تأكد من تشغيل الصوت في المتصفح وأن مستوى الصوت مرتفع');
                            }
                        }, 2000);
                        
                    } catch (error) {
                        console.error('❌ Error starting speech:', error);
                        alert('خطأ في بدء القراءة الصوتية. جرب تحديث الصفحة.');
                        this.stopAudio();
                    }
                };
                
                // Check if voices are loaded
                const voices = this.speechSynth.getVoices();
                if (voices.length === 0) {
                    console.log('⏳ Waiting for voices to load...');
                    // Wait for voices to load
                    this.speechSynth.onvoiceschanged = () => {
                        console.log('🔄 Voices loaded');
                        startSpeech();
                    };
                    
                    // Fallback timeout
                    setTimeout(() => {
                        if (this.speechSynth.getVoices().length === 0) {
                            console.warn('⚠️ No voices loaded, trying anyway...');
                        }
                        startSpeech();
                    }, 1000);
                } else {
                    startSpeech();
                }
            }
            

            
            startWordHighlighting() {
                // Estimate word timing based on speech rate
                const baseWordsPerSecond = 2.5;
                const rate = this.elements.slowMode.checked ? 
                    parseFloat(this.elements.speedRange.value) * 0.6 : 
                    parseFloat(this.elements.speedRange.value);
                const wordsPerSecond = baseWordsPerSecond * rate;
                const wordInterval = 1000 / wordsPerSecond;
                
                this.audioWordIndex = 0;
                this.audioTimer = setInterval(() => {
                    if (this.audioWordIndex < this.words.length && this.isAudioReading) {
                        this.highlightAudioWord(this.audioWordIndex);
                        this.audioWordIndex++;
                    } else {
                        clearInterval(this.audioTimer);
                    }
                }, wordInterval);
            }
            
            highlightAudioWord(wordIndex) {
                const highlightedWords = this.words.map((word, index) => {
                    if (index === wordIndex) {
                        return `<span class="word-highlight">${word}</span>`;
                    }
                    return word;
                });
                
                this.elements.readingText.innerHTML = highlightedWords.join(' ');
                
                // Auto scroll if enabled
                if (this.elements.autoScroll.checked) {
                    const highlightedElement = this.elements.readingText.querySelector('.word-highlight');
                    if (highlightedElement) {
                        highlightedElement.scrollIntoView({
                            behavior: 'smooth',
                            block: 'center'
                        });
                    }
                }
            }
            
            pauseAudio() {
                this.isAudioReading = false;
                this.speechSynth.pause();
                clearInterval(this.audioTimer);
                
                this.elements.playAudioBtn.disabled = false;
                this.elements.pauseAudioBtn.disabled = true;
                this.elements.audioIndicator.classList.add('hidden');
            }
            
            stopAudio() {
                this.isAudioReading = false;
                this.speechSynth.cancel();
                clearInterval(this.audioTimer);
                this.audioWordIndex = 0;
                
                this.elements.playAudioBtn.disabled = false;
                this.elements.pauseAudioBtn.disabled = true;
                this.elements.audioIndicator.classList.add('hidden');
                
                // Remove highlighting
                this.updateText();
            }
            
            repeatCurrentSentence() {
                const currentText = this.texts[this.currentLevel][this.currentTextIndex];
                if (!currentText) return;
                
                // Find current sentence
                const sentences = currentText.content.split(/[.!?]/);
                let currentSentence = sentences[0];
                
                if (this.audioWordIndex > 0) {
                    const wordsUpToCurrent = this.words.slice(0, this.audioWordIndex).join(' ');
                    for (let i = 0; i < sentences.length; i++) {
                        if (sentences[i].includes(wordsUpToCurrent.slice(-20))) {
                            currentSentence = sentences[i];
                            break;
                        }
                    }
                }
                
                // Create utterance for current sentence
                const utterance = new SpeechSynthesisUtterance(currentSentence);
                utterance.lang = 'ar-SA';
                
                let rate = parseFloat(this.elements.speedRange.value);
                if (this.elements.slowMode.checked) {
                    rate = Math.max(0.3, rate * 0.5);
                }
                
                utterance.rate = rate;
                utterance.pitch = parseFloat(this.elements.pitchRange.value);
                utterance.volume = parseFloat(this.elements.volumeRange.value);
                
                // Find Arabic voice
                const voices = this.speechSynth.getVoices();
                const arabicVoice = voices.find(voice => 
                    voice.lang.includes('ar') || 
                    voice.name.toLowerCase().includes('arabic')
                );
                
                if (arabicVoice) {
                    utterance.voice = arabicVoice;
                }
                
                this.speechSynth.speak(utterance);
            }
            
            // Test audio function
            testAudio() {
                console.log('🔊 Testing audio...');
                
                // Cancel any existing speech
                this.speechSynth.cancel();
                
                // Simple test message
                const testMessage = 'مرحباً، هذا اختبار للصوت العربي';
                const testUtterance = new SpeechSynthesisUtterance(testMessage);
                
                // Set basic parameters
                testUtterance.rate = 0.8;
                testUtterance.pitch = 1.0;
                testUtterance.volume = 1.0;
                testUtterance.lang = 'ar-SA';
                
                // Get available voices
                const voices = this.speechSynth.getVoices();
                console.log('🎤 Available voices for test:', voices.length);
                
                // Try to find Arabic voice
                const arabicVoice = voices.find(voice => 
                    voice.lang.includes('ar') || 
                    voice.name.toLowerCase().includes('arabic')
                );
                
                if (arabicVoice) {
                    testUtterance.voice = arabicVoice;
                    console.log('✅ Test using Arabic voice:', arabicVoice.name);
                } else {
                    console.log('⚠️ No Arabic voice found for test, using default');
                }
                
                // Event handlers for test
                testUtterance.onstart = () => {
                    console.log('✅ Test audio started successfully!');
                    this.elements.testAudioBtn.textContent = '🔊 يعمل الصوت!';
                    this.elements.testAudioBtn.style.background = 'linear-gradient(145deg, #48bb78, #38a169)';
                };
                
                testUtterance.onend = () => {
                    console.log('✅ Test audio completed');
                    setTimeout(() => {
                        this.elements.testAudioBtn.textContent = '🔊 اختبار الصوت';
                        this.elements.testAudioBtn.style.background = '';
                    }, 2000);
                };
                
                testUtterance.onerror = (event) => {
                    console.error('❌ Test audio error:', event);
                    this.elements.testAudioBtn.textContent = '❌ خطأ في الصوت';
                    this.elements.testAudioBtn.style.background = 'linear-gradient(145deg, #f56565, #e53e3e)';
                    
                    let errorMsg = 'خطأ في اختبار الصوت:\n';
                    switch(event.error) {
                        case 'not-allowed':
                            errorMsg += '• المتصفح يمنع تشغيل الصوت\n• اضغط على أيقونة الصوت في شريط العنوان وأذن بالصوت';
                            break;
                        case 'network':
                            errorMsg += '• مشكلة في الاتصال بالإنترنت';
                            break;
                        case 'synthesis-failed':
                            errorMsg += '• فشل في تشغيل الصوت\n• جرب متصفح آخر مثل Chrome أو Edge';
                            break;
                        default:
                            errorMsg += `• ${event.error}\n• جرب تحديث الصفحة أو استخدام متصفح آخر`;
                    }
                    
                    alert(errorMsg);
                    
                    setTimeout(() => {
                        this.elements.testAudioBtn.textContent = '🔊 اختبار الصوت';
                        this.elements.testAudioBtn.style.background = '';
                    }, 3000);
                };
                
                // Check if speech synthesis is supported
                if (!this.speechSynth) {
                    alert('❌ القراءة الصوتية غير مدعومة في هذا المتصفح!\n\nجرب:\n• Google Chrome\n• Microsoft Edge\n• Firefox الحديث');
                    return;
                }
                
                // Start test
                try {
                    console.log('🎤 Starting audio test...');
                    this.elements.testAudioBtn.textContent = '⏳ جاري الاختبار...';
                    this.speechSynth.speak(testUtterance);
                    
                    // Fallback check
                    setTimeout(() => {
                        if (!this.speechSynth.speaking) {
                            console.warn('⚠️ Test speech may not have started');
                            this.elements.testAudioBtn.textContent = '⚠️ تحقق من الصوت';
                            this.elements.testAudioBtn.style.background = 'linear-gradient(145deg, #ed8936, #dd6b20)';
                            
                            setTimeout(() => {
                                this.elements.testAudioBtn.textContent = '🔊 اختبار الصوت';
                                this.elements.testAudioBtn.style.background = '';
                            }, 3000);
                        }
                    }, 1000);
                    
                } catch (error) {
                    console.error('❌ Error in test audio:', error);
                    alert('خطأ في اختبار الصوت. تأكد من أن المتصفح يدعم القراءة الصوتية.');
                }
            }
            
            // Handle audio file upload
            handleAudioFileUpload(event) {
                const files = Array.from(event.target.files);
                if (files.length === 0) return;
                
                this.elements.uploadedFiles.classList.remove('hidden');
                this.elements.filesList.innerHTML = '';
                
                files.forEach((file, index) => {
                    if (file.type.startsWith('audio/')) {
                        const fileItem = document.createElement('div');
                        fileItem.className = 'flex items-center justify-between bg-blue-50 p-3 rounded-lg';
                        
                        const fileName = document.createElement('span');
                        fileName.textContent = `${index + 1}. ${file.name}`;
                        fileName.className = 'text-sm font-medium text-gray-700';
                        
                        const fileSize = document.createElement('span');
                        fileSize.textContent = `${(file.size / 1024 / 1024).toFixed(2)} MB`;
                        fileSize.className = 'text-xs text-gray-500';
                        
                        const playButton = document.createElement('button');
                        playButton.textContent = '▶️';
                        playButton.className = 'bg-blue-500 text-white px-2 py-1 rounded text-sm hover:bg-blue-600';
                        playButton.onclick = () => this.playUploadedFile(file);
                        
                        fileItem.appendChild(fileName);
                        fileItem.appendChild(fileSize);
                        fileItem.appendChild(playButton);
                        
                        this.elements.filesList.appendChild(fileItem);
                        
                        // Store the file for later use
                        this.storeAudioFile(file, index);
                    }
                });
                
                this.showAudioStatus(`📁 تم تحميل ${files.length} ملف صوتي بنجاح!`);
            }
            
            // Store audio file for use
            storeAudioFile(file, index) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const audioUrl = e.target.result;
                    
                    // Store in current level and text index
                    if (!this.uploadedAudioFiles) {
                        this.uploadedAudioFiles = {};
                    }
                    
                    if (!this.uploadedAudioFiles[this.currentLevel]) {
                        this.uploadedAudioFiles[this.currentLevel] = {};
                    }
                    
                    this.uploadedAudioFiles[this.currentLevel][index] = audioUrl;
                };
                reader.readAsDataURL(file);
            }
            
            // Play uploaded audio file
            playUploadedFile(file) {
                const audio = new Audio();
                const reader = new FileReader();
                
                reader.onload = (e) => {
                    audio.src = e.target.result;
                    audio.play().then(() => {
                        this.showAudioStatus(`🎵 تشغيل الملف: ${file.name}`);
                    }).catch((error) => {
                        console.error('Error playing uploaded file:', error);
                        this.showAudioError('synthesis-failed');
                    });
                };
                
                reader.readAsDataURL(file);
            }
            
            // Use uploaded audio if available, otherwise use speech synthesis
            async getAudioForCurrentText() {
                const hasUploadedAudio = this.uploadedAudioFiles && 
                                       this.uploadedAudioFiles[this.currentLevel] && 
                                       this.uploadedAudioFiles[this.currentLevel][this.currentTextIndex];
                
                if (hasUploadedAudio) {
                    // Use uploaded audio file
                    const audio = new Audio(this.uploadedAudioFiles[this.currentLevel][this.currentTextIndex]);
                    return audio;
                } else {
                    // Use speech synthesis
                    return await this.audioFiles[this.currentLevel][this.currentTextIndex];
                }
            }
            
            // Statistics and progress tracking
            saveSession() {
                const stats = this.getStats();
                const minutes = this.elapsedTime / 60000;
                const speed = minutes > 0 ? Math.round(this.currentWordIndex / minutes) : 0;
                
                stats.totalSessions++;
                stats.totalWords += this.currentWordIndex;
                stats.totalTime += Math.round(minutes);
                stats.speeds.push(speed);
                stats.bestSpeed = Math.max(stats.bestSpeed, speed);
                
                // Add to progress data for chart
                this.progressData.push({
                    date: new Date().toLocaleDateString('ar-SA'),
                    speed: speed,
                    words: this.currentWordIndex,
                    level: this.currentLevel,
                    accuracy: Math.min(100, Math.max(80, 100 - (this.elapsedTime / 1000 - this.currentWordIndex) * 2))
                });
                
                // Keep only last 30 sessions
                if (this.progressData.length > 30) {
                    this.progressData = this.progressData.slice(-30);
                }
                
                localStorage.setItem('readingStats', JSON.stringify(stats));
                localStorage.setItem('progressData', JSON.stringify(this.progressData));
                this.updateStatsDisplay();
                this.updateChart();
            }
            
            getStats() {
                const defaultStats = {
                    totalSessions: 0,
                    totalWords: 0,
                    totalTime: 0,
                    speeds: [],
                    bestSpeed: 0
                };
                
                const saved = localStorage.getItem('readingStats');
                return saved ? JSON.parse(saved) : defaultStats;
            }
            
            loadStats() {
                this.updateStatsDisplay();
            }
            
            updateStatsDisplay() {
                const stats = this.getStats();
                const avgSpeed = stats.speeds.length > 0 
                    ? Math.round(stats.speeds.reduce((a, b) => a + b, 0) / stats.speeds.length)
                    : 0;
                
                this.elements.totalSessions.textContent = stats.totalSessions;
                this.elements.totalWords.textContent = stats.totalWords.toLocaleString('ar-SA');
                this.elements.totalTime.textContent = stats.totalTime + 'د';
                this.elements.avgSpeed.textContent = avgSpeed;
                this.elements.bestSpeed.textContent = stats.bestSpeed;
                
                // Update accuracy (simulated based on performance)
                const accuracy = Math.min(100, Math.max(85, 95 + (avgSpeed - 100) * 0.1));
                this.elements.accuracy.textContent = Math.round(accuracy) + '%';
            }
            
            clearStats() {
                if (confirm('هل أنت متأكد من مسح جميع الإحصائيات؟ لن يمكن استرداد هذه البيانات.')) {
                    localStorage.removeItem('readingStats');
                    localStorage.removeItem('progressData');
                    this.progressData = [];
                    this.updateStatsDisplay();
                    this.updateChart();
                    this.updateAchievements();
                    alert('تم مسح جميع الإحصائيات بنجاح! 🗑️');
                }
            }
            
            // Encouragement system
            updateEncouragement(type) {
                const encouragements = this.encouragements[type];
                const randomEncouragement = encouragements[Math.floor(Math.random() * encouragements.length)];
                
                this.elements.encouragementTitle.textContent = randomEncouragement.title;
                this.elements.encouragementText.textContent = randomEncouragement.text;
            }
            
            // Progress chart
            initializeChart() {
                const ctx = this.elements.progressChart.getContext('2d');
                
                this.chart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'سرعة القراءة (كلمة/دقيقة)',
                            data: [],
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: '#667eea',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 6
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: {
                                    font: {
                                        family: 'Cairo',
                                        size: 14,
                                        weight: 'bold'
                                    }
                                }
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'كلمة/دقيقة',
                                    font: {
                                        family: 'Cairo',
                                        size: 12,
                                        weight: 'bold'
                                    }
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'الجلسات',
                                    font: {
                                        family: 'Cairo',
                                        size: 12,
                                        weight: 'bold'
                                    }
                                }
                            }
                        }
                    }
                });
                
                this.updateChart();
            }
            
            updateChart() {
                if (!this.chart) return;
                
                const labels = this.progressData.map((_, index) => `جلسة ${index + 1}`);
                const speeds = this.progressData.map(session => session.speed);
                
                this.chart.data.labels = labels;
                this.chart.data.datasets[0].data = speeds;
                this.chart.update();
            }
            
            // Achievement system
            updateAchievements() {
                const stats = this.getStats();
                const achievements = [];
                
                // Session-based achievements
                if (stats.totalSessions >= 1) achievements.push({ icon: '🎯', title: 'أول خطوة', desc: 'أكملت جلستك الأولى' });
                if (stats.totalSessions >= 5) achievements.push({ icon: '🔥', title: 'مثابر', desc: '5 جلسات مكتملة' });
                if (stats.totalSessions >= 10) achievements.push({ icon: '💪', title: 'قوي الإرادة', desc: '10 جلسات مكتملة' });
                if (stats.totalSessions >= 25) achievements.push({ icon: '🏆', title: 'بطل القراءة', desc: '25 جلسة مكتملة' });
                
                // Speed-based achievements
                if (stats.bestSpeed >= 50) achievements.push({ icon: '⚡', title: 'سريع', desc: 'وصلت لـ 50 كلمة/دقيقة' });
                if (stats.bestSpeed >= 100) achievements.push({ icon: '🚀', title: 'فائق السرعة', desc: 'وصلت لـ 100 كلمة/دقيقة' });
                if (stats.bestSpeed >= 150) achievements.push({ icon: '⭐', title: 'نجم القراءة', desc: 'وصلت لـ 150 كلمة/دقيقة' });
                
                // Word-based achievements
                if (stats.totalWords >= 100) achievements.push({ icon: '📚', title: 'قارئ نشط', desc: 'قرأت 100 كلمة' });
                if (stats.totalWords >= 500) achievements.push({ icon: '🎓', title: 'طالب متميز', desc: 'قرأت 500 كلمة' });
                if (stats.totalWords >= 1000) achievements.push({ icon: '👑', title: 'ملك القراءة', desc: 'قرأت 1000 كلمة' });
                
                // Time-based achievements
                if (stats.totalTime >= 30) achievements.push({ icon: '⏰', title: 'مخصص للوقت', desc: '30 دقيقة من القراءة' });
                if (stats.totalTime >= 60) achievements.push({ icon: '🕐', title: 'ساعة كاملة', desc: 'ساعة من القراءة' });
                
                this.displayAchievements(achievements);
            }
            
            displayAchievements(achievements) {
                this.elements.achievementBadges.innerHTML = '';
                
                if (achievements.length === 0) {
                    this.elements.achievementBadges.innerHTML = '<p class="text-gray-500 text-center col-span-2">ابدأ القراءة لكسب الإنجازات! 🎯</p>';
                    return;
                }
                
                achievements.forEach(achievement => {
                    const badge = document.createElement('div');
                    badge.className = 'bg-gradient-to-r from-yellow-400 to-orange-500 text-white p-3 rounded-xl text-center transform hover:scale-105 transition-all';
                    badge.innerHTML = `
                        <div class="text-2xl mb-1">${achievement.icon}</div>
                        <div class="font-bold text-sm">${achievement.title}</div>
                        <div class="text-xs opacity-90">${achievement.desc}</div>
                    `;
                    this.elements.achievementBadges.appendChild(badge);
                });
            }
        }
        
        // Initialize the platform when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            new SmartReadingPlatform();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'976d3e8795378e29',t:'MTc1NjQ4MzA0Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
